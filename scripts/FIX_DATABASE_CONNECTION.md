# üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: –°–æ–æ–±—â–µ–Ω–∏—è –Ω–µ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö

## –ü—Ä–æ–±–ª–µ–º–∞

–°–æ–æ–±—â–µ–Ω–∏—è —É—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –≤ Kafka, –Ω–æ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü–µ `asset_transactions`.

## ‚úÖ –ü—Ä–∏—á–∏–Ω–∞ –∏ —Ä–µ—à–µ–Ω–∏–µ

### –ü—Ä–∏—á–∏–Ω–∞ 1: –ü—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î

**–ü—Ä–æ–±–ª–µ–º–∞:** –í `appsettings.json` —Å—Ç—Ä–æ–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –±—ã–ª–∞ –ø—É—Å—Ç–æ–π:
```json
{
  "ConnectionStrings": {
    "analytics-db": ""
  }
}
```

**–†–µ—à–µ–Ω–∏–µ:** –ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Å—Ç—Ä–æ–∫—É –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:
```json
{
  "ConnectionStrings": {
    "analytics-db": "Host=localhost;Port=5432;Database=analytics-db;Username=postgres;Password=postgres"
  }
}
```

### –ü—Ä–∏—á–∏–Ω–∞ 2: –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –Ω–µ —Å–æ–∑–¥–∞–Ω–∞

**–ü—Ä–æ–≤–µ—Ä–∫–∞:**
```sql
-- –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ PostgreSQL
psql -U postgres -h localhost

-- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –ª–∏ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
\l

-- –ï—Å–ª–∏ –±–∞–∑—ã –Ω–µ—Ç, —Å–æ–∑–¥–∞–π—Ç–µ –µ—ë
CREATE DATABASE analytics-db;
```

### –ü—Ä–∏—á–∏–Ω–∞ 3: –¢–∞–±–ª–∏—Ü–∞ –Ω–µ —Å–æ–∑–¥–∞–Ω–∞ (–º–∏–≥—Ä–∞—Ü–∏–∏ –Ω–µ –ø—Ä–∏–º–µ–Ω–µ–Ω—ã)

**–†–µ—à–µ–Ω–∏–µ:**
```powershell
# –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –ø—Ä–æ–µ–∫—Ç–∞
cd src\backend\services\AnalyticsService\AnalyticsService.WebApi

# –ü—Ä–∏–º–µ–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏
dotnet ef database update --project ..\AnalyticsService.Infrastructure.EntityFramework --startup-project .
```

### –ü—Ä–∏—á–∏–Ω–∞ 4: AnalyticsService –Ω–µ –∑–∞–ø—É—â–µ–Ω

**–†–µ—à–µ–Ω–∏–µ:**
```powershell
# –ó–∞–ø—É—Å—Ç–∏—Ç–µ AnalyticsService
cd src\backend\services\AnalyticsService\AnalyticsService.WebApi
dotnet run
```

## üìã –ü–æ—à–∞–≥–æ–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

### –®–∞–≥ 1: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç—Ä–æ–∫—É –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è

**–§–∞–π–ª:** `src/backend/services/AnalyticsService/AnalyticsService.WebApi/appsettings.json`

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —Å—Ç—Ä–æ–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∞:
```json
{
  "ConnectionStrings": {
    "analytics-db": "Host=localhost;Port=5432;Database=analytics-db;Username=postgres;Password=postgres"
  }
}
```

**–í–∞–∂–Ω–æ:** –ó–∞–º–µ–Ω–∏—Ç–µ `postgres` –Ω–∞ –≤–∞—à–∏ —Ä–µ–∞–ª—å–Ω—ã–µ —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ PostgreSQL.

### –®–∞–≥ 2: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö

```sql
-- –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ PostgreSQL
psql -U postgres -h localhost

-- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –±–∞–∑—ã
\l

-- –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ –±–∞–∑–µ
\c analytics-db

-- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã
\dt

-- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∑–∞–ø–∏—Å–∏
SELECT COUNT(*) FROM asset_transactions;
```

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ AnalyticsService

–ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ AnalyticsService –¥–æ–ª–∂–Ω—ã –ø–æ—è–≤–∏—Ç—å—Å—è –∑–∞–ø–∏—Å–∏:
```
[Info] –ó–∞–ø—É—Å–∫ Kafka Consumer –¥–ª—è —Ç–æ–ø–∏–∫–∞: portfolio.transactions
[Info] –£—Å–ø–µ—à–Ω–æ –ø–æ–¥–ø–∏—Å–∞–ª–∏—Å—å –Ω–∞ —Ç–æ–ø–∏–∫ portfolio.transactions
```

–ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏—è:
```
[Info] –ü–æ–ª—É—á–µ–Ω –±–∞—Ç—á –∏–∑ 1 —Å–æ–æ–±—â–µ–Ω–∏–π
[Info] –ë–∞—Ç—á —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π —Å–æ—Ö—Ä–∞–Ω–µ–Ω: 1 —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π –∑–∞ –æ–¥–∏–Ω –∑–∞–ø—Ä–æ—Å –∫ –ë–î
```

**–ï—Å–ª–∏ –≤–∏–¥–∏—Ç–µ –æ—à–∏–±–∫–∏:**
- `Unable to connect to database` ‚Üí –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç—Ä–æ–∫—É –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å PostgreSQL
- `Table 'asset_transactions' does not exist` ‚Üí –ü—Ä–∏–º–µ–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏
- `No connection string found` ‚Üí –ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Å—Ç—Ä–æ–∫—É –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –≤ appsettings.json

### –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Consumer Group

```powershell
# –ï—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω Kafka CLI
kafka-consumer-groups --bootstrap-server localhost:9092 --group analytics-service-transactions --describe
```

**–ß—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:**
- Consumer Group —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
- `LAG` (–æ—Ç—Å—Ç–∞–≤–∞–Ω–∏–µ) = 0 (–≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã)
- –ï—Å–ª–∏ `LAG > 0`, –∑–Ω–∞—á–∏—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è

## üöÄ –ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è

1. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ AnalyticsService:**
   ```powershell
   cd src\backend\services\AnalyticsService\AnalyticsService.WebApi
   dotnet run
   ```

2. **–û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ç–µ—Å—Ç–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ:**
   ```powershell
   .\scripts\send_test_kafka_message.ps1
   ```

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö:**
   ```sql
   SELECT * FROM asset_transactions ORDER BY transaction_time DESC LIMIT 5;
   ```

4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ AnalyticsService** –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –∑–∞–ø–∏—Å–µ–π –æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

1. **–°—Ç—Ä–æ–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –∑–∞–ø–æ–ª–Ω–µ–Ω–∞** - –±–µ–∑ –Ω–µ—ë DbContext –Ω–µ —Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è
2. **–ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –¥–æ–ª–∂–Ω–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞—Ç—å** - —Å–æ–∑–¥–∞–π—Ç–µ –µ—ë, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
3. **–ú–∏–≥—Ä–∞—Ü–∏–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –ø—Ä–∏–º–µ–Ω–µ–Ω—ã** - –≤—ã–ø–æ–ª–Ω–∏—Ç–µ `dotnet ef database update`
4. **AnalyticsService –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞–ø—É—â–µ–Ω** - –∏–Ω–∞—á–µ —Å–æ–æ–±—â–µ–Ω–∏—è –Ω–µ –±—É–¥—É—Ç –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å—Å—è
5. **Kafka –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥–æ—Å—Ç—É–ø–µ–Ω** - –∏–Ω–∞—á–µ Consumer –Ω–µ –ø–æ–¥–∫–ª—é—á–∏—Ç—Å—è

## üîç –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∏:
```powershell
.\scripts\check_kafka_consumer.ps1
```

–°–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä–∏—Ç:
- ‚úÖ –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å Kafka
- ‚úÖ –ó–∞–ø—É—Å–∫ AnalyticsService
- ‚úÖ Consumer Group
- ‚úÖ –¢–æ–ø–∏–∫
- ‚úÖ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é

**üìñ –ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞:** [DIAGNOSTICS.md](DIAGNOSTICS.md)

