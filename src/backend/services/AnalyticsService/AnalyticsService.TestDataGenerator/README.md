# AnalyticsService.TestDataGenerator

Генератор тестовых данных для заполнения базы данных аналитики.

## Описание

Проект создает тестовые данные для базы данных AnalyticsService:
- **7 компаний**: Сбербанк, Альфа-Банк, Россельхозбанк, Тинькофф Банк, Газпром, Роснефть, Татнефть
- **4 портфеля** с 3-7 активами в каждом
- **Пересекающиеся активы**: в 3 портфелях часть активов совпадает (для анализа согласованности покупок/продаж)
- **Транзакции**: по 5-15 транзакций на каждый актив за последние 90 дней

## Требования

- .NET 9.0
- PostgreSQL база данных AnalyticsService
- Настроенная строка подключения к БД

## Настройка

1. Отредактируйте `appsettings.json` и укажите строку подключения к базе данных:

```json
{
  "ConnectionStrings": {
    "analytics-db": "Host=localhost;Port=5432;Database=analytics-db;Username=postgres;Password=postgres"
  }
}
```

Или установите переменную окружения:
```bash
export ANALYTICS_DB_CONNECTION_STRING="Host=localhost;Port=5432;Database=analytics-db;Username=postgres;Password=postgres"
```

## Использование

### Запуск из командной строки

```bash
cd src/backend/services/AnalyticsService/AnalyticsService.TestDataGenerator
dotnet run
```

### Запуск из корня решения

```bash
dotnet run --project src/backend/services/AnalyticsService/AnalyticsService.TestDataGenerator/AnalyticsService.TestDataGenerator.csproj
```

## Генерируемые данные

### Компании

| Тикер | Название | Базовая цена | Диапазон цен |
|-------|----------|--------------|--------------|
| SBER | ПАО Сбербанк | 350.0 RUB | 300-400 RUB |
| ALFA | ПАО Альфа-Банк | 45.0 RUB | 40-50 RUB |
| RSHB | ПАО Россельхозбанк | 25.0 RUB | 20-30 RUB |
| TCSG | ПАО Тинькофф Банк | 3800.0 RUB | 3500-4100 RUB |
| GAZP | ПАО Газпром | 180.0 RUB | 160-200 RUB |
| ROSN | ПАО Роснефть | 550.0 RUB | 500-600 RUB |
| TATN | ПАО Татнефть | 420.0 RUB | 380-460 RUB |

### Портфели

- **Портфель 1-3**: Содержат пересекающиеся активы (первые 3 компании: SBER, ALFA, RSHB)
- **Портфель 4**: Случайные активы без пересечений

### Транзакции

- **Количество**: 5-15 транзакций на каждый актив
- **Период**: Последние 90 дней
- **Типы**: 70% покупок, 30% продаж
- **Количество акций**: 10-1000 штук на транзакцию
- **Цены**: Случайные в диапазоне компании

## Вывод программы

Программа выводит:
- Список созданных компаний с их ID
- Список портфелей с количеством активов
- Количество транзакций по каждому портфелю
- Общую статистику (покупки/продажи)
- Статистику по портфелям
- Список пересекающихся активов

## Пример вывода

```
=== Генератор тестовых данных для AnalyticsService ===

Подключение к БД: Host=localhost...
✓ Подключение к базе данных успешно

Генерация компаний...
✓ Создано компаний: 7
  - SBER: ПАО Сбербанк (ID: ...)
  - ALFA: ПАО Альфа-Банк (ID: ...)
  ...

Генерация портфелей...
✓ Создано портфелей: 4
  - Портфель 1 (ID: ...): 5 активов
  ...

Генерация транзакций...
  - Портфель 1: 45 транзакций
  ...
✓ Всего транзакций: 180

Сохранение данных в базу данных...
✓ Сохранено транзакций: 180

=== Статистика ===
Компаний: 7
Портфелей: 4
Транзакций: 180
Покупок: 126
Продаж: 54

=== Пересекающиеся активы ===
  SBER (ПАО Сбербанк): в 3 портфелях
  ALFA (ПАО Альфа-Банк): в 3 портфелях
  RSHB (ПАО Россельхозбанк): в 3 портфелях

✓ Генерация данных завершена успешно!
```

## Структура проекта

```
AnalyticsService.TestDataGenerator/
├── Models/
│   ├── CompanyAsset.cs          # Модель компании
│   └── PortfolioData.cs         # Модель портфеля
├── Services/
│   └── TestDataGenerator.cs     # Генератор данных
├── Program.cs                   # Точка входа
├── appsettings.json            # Конфигурация
└── README.md                    # Документация
```

## Примечания

- Данные генерируются случайным образом, поэтому при каждом запуске будут созданы разные транзакции
- ID компаний и портфелей генерируются случайно (Guid)
- Для анализа согласованности покупок/продаж используйте пересекающиеся активы в портфелях 1-3


