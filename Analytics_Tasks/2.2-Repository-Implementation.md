# Task 2.2: Implement Repositories

**Section:** Infrastructure Layer - Database  
**Priority:** High  
**Estimated Time:** 3-4 hours  
**Dependencies:** Task 2.1 (EF Core Configuration)

## Objective

Implement repository interfaces and EF Core implementations for data access.

## Requirements

### Repository Interfaces (Application Layer)

Define contracts in `Application/Interfaces/Repositories/`:
- `IAssetTransactionRepository`
- `IAssetRatingRepository`

**Key methods:**
- CRUD operations (GetById, Add, Update, Delete)
- Query methods (GetByPeriod, GetByStockCard, GetByPortfolio)
- Batch operations (UpsertBatch for ratings)
- Top rankings queries (GetTopBought, GetTopSold)

### Repository Implementations (Infrastructure Layer)

Implement in `Infrastructure/Persistence/Repositories/`:
- `AssetTransactionRepository`
- `AssetRatingRepository`

**Performance optimizations:**
- Use `AsNoTracking()` for read-only queries
- Implement batch upsert using PostgreSQL `ON CONFLICT` clause
- Use `CancellationToken` for async operations

## Acceptance Criteria

- [ ] Repository interfaces in Application/Interfaces/Repositories/
- [ ] Implementations in Infrastructure/Persistence/Repositories/
- [ ] Batch upsert optimized (UpsertBatchAsync)
- [ ] All queries use appropriate indexes
- [ ] Repositories registered in DI container

## File Structure

```
Application/
  Interfaces/
    Repositories/
      IAssetTransactionRepository.cs
      IAssetRatingRepository.cs

Infrastructure/
  Persistence/
    Repositories/
      AssetTransactionRepository.cs
      AssetRatingRepository.cs
```