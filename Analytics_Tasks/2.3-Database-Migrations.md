# Task 2.3: Create Database Migrations

**Section:** Infrastructure Layer - Database  
**Priority:** High  
**Estimated Time:** 1 hour  
**Dependencies:** Task 2.1 (EF Core Configuration)

## Objective

Generate and apply EF Core migrations for database schema.

## Commands

```bash
# Generate migration
dotnet ef migrations add InitialAnalyticsSchema \
  -p Infrastructure \
  -s WebApi

# Review generated migration
# Verify Up() and Down() methods

# Apply migration
dotnet ef database update \
  -p Infrastructure \
  -s WebApi
```

## Verification

**Tables created:**
- `asset_transactions` (with indexes on stock_card_id, portfolio_id, transaction_date)
- `asset_ratings` (with indexes on stock_card_id, period_start/end, context)

**Verify using psql:**
```sql
\dt  -- List tables
\d asset_transactions  -- Show table structure
\di  -- List indexes
```

## Acceptance Criteria

- [ ] Migration file in Infrastructure/Persistence/Migrations/
- [ ] Both tables created with correct schema
- [ ] All indexes created
- [ ] Down() rollback works correctly
- [ ] Migration applied to local PostgreSQL

## Testing Rollback

```bash
# Rollback
dotnet ef database update 0 -p Infrastructure -s WebApi

# Re-apply
dotnet ef database update -p Infrastructure -s WebApi
```