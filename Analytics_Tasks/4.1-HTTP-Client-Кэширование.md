# Задание 4.1: HTTP клиент с кэшированием

**Раздел:** Infrastructure Layer - HTTP Client  
**Приоритет:** Средний  
**Время:** 3-4 часа  
**Зависимости:** 5.2

## Цель

Реализовать HTTP клиент для взаимодействия с PortfolioService.

## Требования

### IPortfolioServiceClient

Местоположение: `Application/Interfaces/`

```csharp
public interface IPortfolioServiceClient
{
    Task<PortfolioStateDto?> GetCurrentStateAsync(Guid portfolioId, CancellationToken ct);
    Task<IEnumerable<PortfolioHistoryDto>> GetHistoryAsync(Guid portfolioId, DateTime start, DateTime end, CancellationToken ct);
    Task<IEnumerable<PortfolioStateDto>> GetMultipleStatesAsync(IEnumerable<Guid> portfolioIds, CancellationToken ct);
}
```

### PortfolioServiceClient

Местоположение: `Infrastructure/Http/`

**Возможности:**
- Retry: 3 попытки, экспоненциальная задержка (Polly)
- Circuit breaker: 5 сбоев → 30 секунд перерыв
- Кэширование: только GetHistoryAsync (TTL = 5 минут)
- Обработка ошибок: 404 → null, 503 → пробросить

**Стратегия кэширования:**
- ✅ GetHistoryAsync - кэшируется (5 мин)
- ❌ GetCurrentStateAsync - не кэшируется
- ❌ GetMultipleStatesAsync - не кэшируется

**Ключ кэша:**
```
portfolio:history:{portfolioId}:{startDate:yyyyMMdd}:{endDate:yyyyMMdd}
```

## Критерии приёмки

- [ ] Интерфейс в Application/Interfaces/
- [ ] Реализация в Infrastructure/Http/
- [ ] Polly политики настроены
- [ ] Кэширование только history
- [ ] Cache hit/miss логируются
- [ ] Зарегистрировано в DI

## Структура

```
Application/Interfaces/IPortfolioServiceClient.cs
Infrastructure/Http/PortfolioServiceClient.cs
```
