# Задание 1.1: Реализация доменных сущностей

**Раздел:** Domain Layer  
**Приоритет:** Высокий  
**Время:** 2-3 часа  
**Зависимости:** Нет

## Цель

Реализовать основные доменные сущности (AssetTransaction, AssetRating), представляющие бизнес-концепции в домене Analytics.

## Требования

### AssetTransaction (Сущность)

Представляет отдельную транзакцию портфеля, полученную из Kafka.

**Свойства:**
- `Id` (Guid) - уникальный идентификатор
- `PortfolioId` (Guid) - ID портфеля
- `StockCardId` (Guid) - ID актива
- `TransactionType` (TransactionType) - тип транзакции (Buy/Sell)
- `Quantity` (decimal) - количество
- `Price` (decimal) - цена за единицу
- `TotalAmount` (decimal) - общая сумма
- `TransactionDate` (DateTime) - дата транзакции
- `CreatedAt` (DateTime) - дата создания записи

**Бизнес-правила:**
- Quantity > 0
- Price >= 0
- TotalAmount = Quantity * Price (вычисляется автоматически)
- TransactionDate не может быть в будущем
- Id генерируется при создании (new Guid())
- CreatedAt устанавливается в UTC now при создании

**Фабричный метод:**
```csharp
public static AssetTransaction Create(
    Guid portfolioId,
    Guid stockCardId,
    TransactionType transactionType,
    decimal quantity,
    decimal price,
    DateTime transactionDate)
{
    // Валидация бизнес-правил
    // Расчёт TotalAmount
    // Возврат нового экземпляра
}
```

### AssetRating (Сущность)

Представляет агрегированные данные по активу за период.

**Свойства:**
- `Id` (Guid)
- `StockCardId` (Guid)
- `PeriodStart` (DateTime)
- `PeriodEnd` (DateTime)
- `Context` (AnalysisContext) - Global или Portfolio
- `PortfolioId` (Guid?) - обязателен для Portfolio контекста
- `BuyTransactionCount` (int)
- `SellTransactionCount` (int)
- `TotalBuyAmount` (decimal)
- `TotalSellAmount` (decimal)
- `TransactionCountRank` (int)
- `TransactionAmountRank` (int)
- `UpdatedAt` (DateTime)

**Бизнес-правила:**
- PeriodStart < PeriodEnd
- Если Context == Portfolio, то PortfolioId обязателен
- Если Context == Global, то PortfolioId должен быть null
- Все счётчики и суммы >= 0
- Ранги > 0

**Методы:**
```csharp
public void UpdateCounts(int buyCount, int sellCount, decimal buyAmount, decimal sellAmount)
public void AssignRanks(int countRank, int amountRank)
public void MarkAsUpdated()
public AssetRating Clone() // Для инкрементального обновления
```

## Критерии приёмки

- [ ] Класс AssetTransaction в Domain/Entities/
- [ ] Класс AssetRating в Domain/Entities/
- [ ] Все свойства имеют private setters
- [ ] Фабричные методы валидируют бизнес-правила
- [ ] TotalAmount вычисляется автоматически
- [ ] CreatedAt и UpdatedAt устанавливаются автоматически
- [ ] Нет атрибутов EF Core (чистая доменная логика)

## Структура файлов

```
Domain/
  Entities/
    AssetTransaction.cs
    AssetRating.cs
```

## Тестирование

Юнит-тесты будут созданы в Разделе 7 (Задание 7.1).
