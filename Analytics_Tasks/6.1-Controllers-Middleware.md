# Задание 6.1: API Controllers и Middleware

**Раздел:** WebApi Layer  
**Приоритет:** Высокий  
**Время:** 3-4 часа  
**Зависимости:** 5.1, 5.2

## Цель

Реализовать REST API endpoints и глобальную обработку ошибок.

## Компоненты

### AssetAnalyticsController

```csharp
[ApiController]
[Route("api/analytics/assets")]
[Authorize]
public class AssetAnalyticsController : ControllerBase
{
    // GET /api/analytics/assets/top-bought
    // GET /api/analytics/assets/top-sold
}
```

### PortfolioAnalyticsController

```csharp
[ApiController]
[Route("api/analytics/portfolios")]
[Authorize]
public class PortfolioAnalyticsController : ControllerBase
{
    // GET /api/analytics/portfolios/{id}/history
    // POST /api/analytics/portfolios/compare
}
```

### GlobalExceptionMiddleware

Обработка всех исключений:
- ArgumentException → 400
- UnauthorizedAccessException → 401
- KeyNotFoundException → 404
- HttpRequestException → 503
- Остальные → 500

### Swagger

Настройка OpenAPI с JWT Bearer authentication.

## Критерии приёмки

- [ ] Controllers в WebApi/Controllers/
- [ ] [Authorize] атрибуты
- [ ] ProducesResponseType
- [ ] Middleware обработки ошибок
- [ ] Swagger UI
- [ ] Корректные HTTP статусы

## Структура

```
WebApi/
  Controllers/
    AssetAnalyticsController.cs
    PortfolioAnalyticsController.cs
  Middleware/
    GlobalExceptionMiddleware.cs
```
