# Задание 3.1: Настройка Kafka Consumer

**Раздел:** Infrastructure Layer - Kafka  
**Приоритет:** Высокий  
**Время:** 3-4 часа  
**Зависимости:** 2.2

## Цель

Реализовать Kafka Consumer для получения транзакций портфелей из PortfolioService.

## Требования

### KafkaConfiguration

```csharp
public class KafkaConfiguration
{
    public string BootstrapServers { get; set; } = "localhost:9092";
    public string ConsumerGroup { get; set; } = "analytics-service-transactions";
    public string Topic { get; set; } = "portfolio.transactions";
    public int BatchSize { get; set; } = 100;
}
```

### TransactionMessage DTO

```csharp
public class TransactionMessage
{
    public Guid TransactionId { get; set; }
    public Guid PortfolioId { get; set; }
    public Guid StockCardId { get; set; }
    public string TransactionType { get; set; } // "Buy" или "Sell"
    public decimal Quantity { get; set; }
    public decimal Price { get; set; }
    public decimal TotalAmount { get; set; }
    public DateTime TransactionDate { get; set; }
}
```

### TransactionConsumer (Background Service)

**Ключевые возможности:**
- Пакетное потребление (100 сообщений)
- Ручной commit после успешной обработки пакета
- Обработка ошибок с логированием
- Публикация TransactionReceivedEvent после сохранения

**Алгоритм:**
1. Подписаться на topic `portfolio.transactions`
2. Потреблять сообщения пакетами
3. Десериализовать в TransactionMessage
4. Маппить в AssetTransaction (Domain Entity)
5. Сохранить через AssetTransactionRepository
6. Опубликовать TransactionReceivedEvent через EventBus
7. Commit offset

## Критерии приёмки

- [ ] KafkaConfiguration в appsettings.json
- [ ] TransactionMessage DTO
- [ ] TransactionConsumer Background Service
- [ ] Пакетная обработка
- [ ] Ручной commit
- [ ] Публикация события
- [ ] Обработка ошибок
- [ ] Consumer зарегистрирован в DI

## Структура файлов

```
Infrastructure/
  Kafka/
    KafkaConfiguration.cs
    TransactionMessage.cs
    TransactionConsumer.cs
```
